- step:
    name: run-all
    image: docker.io/python:3.10
    command:
    - pip install -r requirements.txt
    - python load_data.py
    - python train.py
    - python visualize.py

- step:
    name: load-data
    image: docker.io/python:3.10
    command:
    - pip install -r requirements.txt
    - python load_data.py
    inputs:
    - name: dataset
      default: https://download.pytorch.org/tutorial/hymenoptera_data.zip

- step:
    name: train-model
    image: docker.io/python:3.10
    command:
    - pip install -r requirements.txt
    - python train.py {parameters}
    inputs:
    - name: preprocessed_dataset
      default: datum://018d180e-22a5-f40f-ac6f-c2140d7c74e7
      optional: false
    parameters:
    - name: lr
      description: learning rate
      default: 0.001
      type: float
    - name: step_size
      type: integer
      default: 7
    - name: num_epochs
      type: integer
      default: 5

- step:
    name: inference
    image: docker.io/python:3.10
    command:
    - pip install -r requirements.txt
    - python visualize.py
    inputs:
    - name: preprocessed_dataset
      default: datum://018d180e-22a5-f40f-ac6f-c2140d7c74e7
      optional: false
    - name: model
      default: datum://latest-model
      optional: false
    - name: image
      default: datum://018d1822-c8bc-28dd-729c-c4b4cafc3e8f
      optional: false

- pipeline:
    name: training_inference
    nodes:
    - name: load_data
      type: execution
      step: load-data
    - name: train
      type: execution
      step: train-model
      override:
        inputs:
          - name: preprocessed_dataset
    - name: inference
      type: execution
      step: inference
      override:
        inputs:
          - name: preprocessed_dataset
    edges:
    - [load_data.outputs.*.zip, train.input.preprocessed_dataset]
    - [load_data.outputs.*.zip, inference.input.preprocessed_dataset]
    - [train.outputs.*.pth, inference.input.model]